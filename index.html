<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ü–∏—Ü—Ü–∞ –≤ Telegram</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 16px;
      background-color: #f5f5f5;
      color: #333;
    }
    .pizza-card {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 16px;
      background: white;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .pizza-card:hover {
      transform: scale(1.02);
    }
    .pizza-card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 8px;
    }
    .pizza-name {
      font-size: 18px;
      font-weight: bold;
      margin: 8px 0;
    }
    .pizza-price {
      font-size: 16px;
      color: #e74c3c;
      font-weight: bold;
    }
    .pizza-desc {
      font-size: 14px;
      color: #666;
    }
    #status {
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>–í—ã–±–µ—Ä–∏ —Å–≤–æ—é –ø–∏—Ü—Ü—É</h1>
  <div id="pizza-container"></div>
  <div id="status"></div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();
    tg.setHeaderColor(tg.themeParams.bg_color || '#ffffff');
    tg.setBackgroundColor(tg.themeParams.bg_color || '#f5f5f5');

    const pizzas = [
      { id: 1, name: "–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞", price: 499, currency: "RUB", image: "https://media.istockphoto.com/id/1168754685/ru/%D1%84%D0%BE%D1%82%D0%BE/%D0%BF%D0%B8%D1%86%D1%86%D0%B0-%D0%BC%D0%B0%D1%80%D0%B3%D0%B0%D1%80%D0%B8%D1%82%D0%B0-%D1%81-%D1%81%D1%8B%D1%80%D0%BE%D0%BC-%D0%B2%D0%B8%D0%B4-%D1%81%D0%B2%D0%B5%D1%80%D1%85%D1%83-%D0%B8%D0%B7%D0%BE%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D1%8B-%D0%BD%D0%B0-%D0%B1%D0%B5%D0%BB%D0%BE%D0%BC-%D1%84%D0%BE%D0%BD%D0%B5.jpg?s=612x612&w=0&k=20&c=2DI8tUW4BmtQKGNl81LzgfxUoXcsmsgk5I5jd1UypI8=", description: "–¢–æ–º–∞—Ç—ã, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, –±–∞–∑–∏–ª–∏–∫" },
      { id: 2, name: "–ü–µ–ø–ø–µ—Ä–æ–Ω–∏", price: 599, currency: "RUB", image: "https://www.shutterstock.com/image-photo/small-size-pizza-pepperoni-on-260nw-2039301926.jpg", description: "–û—Å—Ç—Ä–∞—è –ø–µ–ø–ø–µ—Ä–æ–Ω–∏ —Å —Å—ã—Ä–æ–º" },
      { id: 3, name: "–ì–∞–≤–∞–π—Å–∫–∞—è", price: 549, currency: "RUB", image: "https://www.shutterstock.com/image-photo/hawaiian-pizza-isolation-on-transparent-260nw-2618558339.jpg", description: "–í–µ—Ç—á–∏–Ω–∞, –∞–Ω–∞–Ω–∞—Å—ã, –º–æ—Ü–∞—Ä–µ–ª–ª–∞" },
      { id: 4, name: "–ß–µ—Ç—ã—Ä–µ —Å—ã—Ä–∞", price: 649, currency: "RUB", image: "https://roosters-pizza.ru/wa-data/public/shop/products/17/00/17/images/946/946.750x0.jpg", description: "–ú–æ—Ü–∞—Ä–µ–ª–ª–∞, –¥–æ—Ä-–±–ª—é, –ø–∞—Ä–º–µ–∑–∞–Ω, —á–µ–¥–¥–µ—Ä" }
    ];

    const container = document.getElementById('pizza-container');
    pizzas.forEach(pizza => {
      const card = document.createElement('div');
      card.className = 'pizza-card';
      const priceStr = new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'RUB' }).format(pizza.price);
      card.innerHTML = `
        <img src="${pizza.image.trim()}" alt="${pizza.name}" onerror="this.style.display='none'">
        <div class="pizza-name">${pizza.name}</div>
        <div class="pizza-price">${priceStr}</div>
        <div class="pizza-desc">${pizza.description}</div>
      `;
      card.addEventListener('click', () => buyPizza(pizza));
      container.appendChild(card);
    });

    function buyPizza(pizza) {
      const status = document.getElementById('status');
      status.textContent = "–û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–ø–ª–∞—Ç—É...";
      status.style.color = "#2980b9";

      // üí° –¶–µ–Ω–∞ –≤ —Ä—É–±–ª—è—Ö ‚Üí –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ –∫–æ–ø–µ–π–∫–∏ (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ!)
      const amountInCents = Math.round(pizza.price * 100);

      try {
        tg.openInvoice({
          title: `–ü–∏—Ü—Ü–∞ "${pizza.name}"`,
          description: pizza.description,
          currency: pizza.currency,
          prices: [{ label: "–°—Ç–æ–∏–º–æ—Å—Ç—å", amount: amountInCents }], // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
          payload: `order_pizza_${pizza.id}_${Date.now()}`
        });
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∏–Ω–≤–æ–π—Å–∞:", e);
        status.textContent = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –æ–ø–ª–∞—Ç—É";
        status.style.color = "#e74c3c";
        return;
      }

      tg.onEvent('invoiceClosed', onInvoiceClosed);
    }

    function onInvoiceClosed(data) {
      const status = document.getElementById('status');
      if (data.status === 'paid') {
        status.textContent = '‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!';
        status.style.color = '#27ae60';
      } else if (data.status === 'failed') {
        status.textContent = '‚ùå –û–ø–ª–∞—Ç–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å';
        status.style.color = '#e74c3c';
      } else {
        status.textContent = '‚ÑπÔ∏è –û–ø–ª–∞—Ç–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞';
        status.style.color = '#f39c12';
      }
      tg.offEvent('invoiceClosed', onInvoiceClosed);
    }

    tg.onEvent('themeChanged', () => {
      const bg = tg.themeParams.bg_color || (tg.colorScheme === 'dark' ? '#1e1e1e' : '#f5f5f5');
      document.body.style.backgroundColor = bg;
      document.body.style.color = tg.colorScheme === 'dark' ? '#fff' : '#333';
      tg.setBackgroundColor(bg);
    });
  </script>
</body>
</html>
