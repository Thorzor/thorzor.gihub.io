<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Магазин в Telegram</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Официальная библиотека Telegram Mini Apps -->
  https://telegram.org/js/telegram-web-app.js</script>
  <style>
    :root { color-scheme: light dark; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #111);
    }
    .container { padding: 16px; max-width: 720px; margin: 0 auto; }
    .card {
      border: 1px solid var(--tg-theme-hint-color, #ccc);
      border-radius: 12px; overflow: hidden; margin-bottom: 16px;
      background: var(--tg-theme-secondary-bg-color, #f7f7f7);
    }
    .card img { width: 100%; display: block; }
    .card .body { padding: 12px 16px; }
    .title { font-size: 18px; margin: 0 0 8px; }
    .desc { font-size: 14px; opacity: .8; margin: 0 0 12px; }
    .actions { display:flex; gap:8px; }
    button {
      padding: 10px 14px; border-radius: 10px; border: none; cursor: pointer;
      background: var(--tg-theme-button-color, #2ea6ff);
      color: var(--tg-theme-button-text-color, #fff); font-weight: 600;
    }
    .note { font-size: 13px; opacity:.7; margin-top:8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Магазин</h1>

    <div class="card">
      <img src="https://images.examplepg
      <div class="body">
        <p class="title">Кружка «QA Life»</p>
        <p class="desc">Керамическая кружка 330 мл</p>
        <div class="actions">
          <button id="buy-mug">Купить за ⭐ 599</button>
        </div>
        <div class="note" id="status"></div>
      </div>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // ВСТАВЬТЕ СВОИ ДАННЫЕ из генератора:
    // Можно использовать ПОЛНЫЙ URL (https://t.me/invoice/abcdef...) или просто slug 'abcdef...'
    const INVOICE = {
      coffee_mug: {
        // пример: скопируйте из generate_invoice_links.py
        url: "https://t.me/invoice/abcdefghi"
        // либо: slug: "abcdefghi"
      }
    };

    const statusEl = document.getElementById('status');
    const buyBtn = document.getElementById('buy-mug');

    async function pay(invoice) {
      statusEl.textContent = 'Открываю платёж…';
      try {
        const arg = invoice.url ?? invoice.slug; // URL или slug
        const status = await tg.openInvoice(arg); // вернет 'paid' | 'cancelled' | 'failed' | 'pending'
        if (status === 'paid') {
          statusEl.textContent = '✅ Оплата прошла успешно! Спасибо!';
        } else if (status === 'cancelled') {
          statusEl.textContent = '❕ Платеж отменён.';
        } else if (status === 'failed') {
          statusEl.textContent = '❌ Платеж не прошёл.';
        } else {
          statusEl.textContent = `Статус: ${status}`;
        }
      } catch (e) {
        console.error(e);
        statusEl.textContent = '⚠️ Ошибка при оплате. Попробуйте ещё раз.';
      }
    }

    buyBtn.addEventListener('click', () => pay(INVOICE.coffee_mug));
  </script>
</body>
</html>
